# Created by: iblis <iblis@hs.ntnu.edu.tw>
# $FreeBSD$

PORTNAME=	c-blosc
PORTVERSION=	1.12.1
DISTVERSIONPREFIX=	v
CATEGORIES=	archivers devel
MASTER_SITES=	GH

MAINTAINER=	iblis@hs.ntnu.edu.tw
COMMENT=	Blocking, shuffling and loss-less compression library

LICENSE=	BSD3CLAUSE
LICENSE_FILE=	${WRKSRC}/LICENSES/BLOSC.txt

USES=		cmake
USE_LDCONFIG=	yes

USE_GITHUB=	yes
GH_ACCOUNT=	Blosc
GH_PROJECT=	c-blosc

TEST_TARGET=	test

PLIST_SUB=	VERSION="${PORTVERSION:R:R}" \
		SOVERSION="${PORTVERSION}"

CMAKE_ARGS=	-DBUILD_SHARED=ON

OPTIONS_DEFINE=	STATIC TEST AVX2 LZ4 SNAPPY ZLIB ZSTD
OPTIONS_DEFAULT=	STATIC LZ4 SNAPPY ZLIB ZSTD
OPTIONS_SUB=	yes

STATIC_CMAKE_ON=	-DBUILD_STATIC=ON
STATIC_CMAKE_OFF=	-DBUILD_STATIC=OFF

TEST_CMAKE_ON=		-DBUILD_TESTS=ON -DBUILD_BENCHMARKS=ON
TEST_CMAKE_OFF=		-DBUILD_TESTS=OFF -DBUILD_BENCHMARKS=OFF

AVX2_DESC=	Attempt to build with AVX2 instructions
AVX2_CMAKE_ON=	-DDEACTIVATE_AVX2=OFF
AVX2_CMAKE_OFF=	-DDEACTIVATE_AVX2=ON

LZ4_CMAKE_ON=	-DDEACTIVATE_LZ4=OFF -DPREFER_EXTERNAL_LZ4=ON
LZ4_CMAKE_OFF=	-DDEACTIVATE_LZ4=ON
LZ4_LIB_DEPENDS=	liblz4.so:archivers/liblz4

SNAPPY_CMAKE_ON=	-DDEACTIVATE_SNAPPY=OFF \
			-DPREFER_EXTERNAL_SNAPPY=ON
SNAPPY_CMAKE_OFF=	-DDEACTIVATE_SNAPPY=ON
SNAPPY_LIB_DEPENDS=	libsnappy.so:archivers/snappy

ZLIB_CMAKE_ON=	-DDEACTIVATE_ZLIB=OFF \
		-DPREFER_EXTERNAL_ZLIB=ON
ZLIB_CMAKE_OFF=	-DDEACTIVATE_ZLIB=ON

ZSTD_CMAKE_ON=	-DDEACTIVATE_ZSTD=OFF \
		-DPREFER_EXTERNAL_ZSTD=ON
ZSTD_CMAKE_OFF=	-DDEACTIVATE_ZSTD=ON
ZSTD_LIB_DEPENDS=	libzstd.so:archivers/zstd

.include <bsd.port.options.mk>

.if ${PORT_OPTIONS:MTEST}
post-build: test
.endif

.include <bsd.port.mk>
